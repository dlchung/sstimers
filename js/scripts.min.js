function onMapClick(a){var b=new L.marker(a.latlng).addTo(map),c=b._leaflet_id,d=getPopupContent(c),e={};b.on("popupopen",onPopupOpen),b.bindPopup(d,e).openPopup(),toolTipSettings.className=c,b.bindTooltip("0:00:00",toolTipSettings)}function onPopupOpen(){var a=this;markerData[a._leaflet_id]&&(""!==markerData[a._leaflet_id][2]&&$('input[name="markerHours'+a._leaflet_id+'"]').val(markerData[a._leaflet_id][2]),$('input[name="markerMins'+a._leaflet_id+'"]').val(markerData[a._leaflet_id][3]),$('input[name="markerType'+a._leaflet_id+'"][value="'+markerData[a._leaflet_id][5]+'"').prop("checked",!0)),$(".deleteMarkerButton:visible").click(function(){map.removeLayer(a),onDelete(a)}),$(".saveMarkerButton:visible").click(function(){$(".watermark").watermark("clearWatermarks"),onSave(a)}),$(".resetMarkerButton:visible").click(function(){onReset(a)}),$(".watermark").watermark()}function onSave(a){var d=($("#markerHours").attr("name"),$("#markerMins").attr("name"),$('input[name="markerHours'+a._leaflet_id+'"]').val()),e=$('input[name="markerMins'+a._leaflet_id+'"]').val(),f=Date.now(),g=$('input[name="markerType'+a._leaflet_id+'"]:checked').val();console.log(g);var h=[a._leaflet_id,a._latlng,d,e,f,g];markerData[a._leaflet_id]=h,storeMarkers(markerData),a.setTooltipContent("0:00:00"),updateTime(a._leaflet_id,d,e,f),a.closePopup()}function onDelete(a){delete markerData[a._leaflet_id],storeMarkers(markerData)}function onReset(a){if(markerData[a._leaflet_id]){var b=markerData[a._leaflet_id][2],c=markerData[a._leaflet_id][3],d=Date.now(),e=markerData[a._leaflet_id][5];"lootCrate"==e&&(b="2",c="00"),"uplinkBlockade"==e&&(b="0",c="45"),updateTime(a._leaflet_id,b,c,d),markerData[a._leaflet_id][2]=b,markerData[a._leaflet_id][3]=c,markerData[a._leaflet_id][4]=d,storeMarkers(markerData),a.closePopup()}}function loadMarkers(a){var b=Object();for(var c in a){var d=a[c],f=(d[0],d[2]),g=d[3],h=d[4],i=d[5],j=d[1];loadedMarker=new L.marker(j).addTo(map),toolTipSettings.className=loadedMarker._leaflet_id,loadedMarker.bindTooltip("0:00:00",toolTipSettings),$('input[name="markerType'+loadedMarker._leaflet_id+'"][value="'+i+'"').prop("checked",!0);var k=getPopupContent(loadedMarker._leaflet_id);loadedMarker.on("popupopen",onPopupOpen),loadedMarker.bindPopup(k,popupOptions),updateTime(loadedMarker._leaflet_id,f,g,h),b[loadedMarker._leaflet_id]=[loadedMarker._leaflet_id,loadedMarker._latlng,f,g,h,i]}return b}function storeMarkers(a){localStorage.setItem("markerData",JSON.stringify(a))}function getMarkers(){var a;return localStorage.getItem("markerData")&&(a=JSON.parse(localStorage.getItem("markerData"))),a}function updateTime(a,b,c,d){addToDate=1e3*(60*b*60+60*c),$(".leaflet-tooltip."+a).countdown(d+addToDate,function(a){$(this).html(a.strftime("%-H:%M:%S"))}).on("update.countdown",function(a){a.offset.hours<1?(a.offset.minutes<10&&a.offset.minutes>=3&&($(this).addClass("stage-two-timer"),$(this).removeClass("stage-three-timer")),a.offset.minutes<3&&($(this).addClass("stage-three-timer"),$(this).removeClass("stage-two-timer"))):($(this).removeClass("stage-two-timer"),$(this).removeClass("stage-three-timer"))})}function getPopupContent(a){return popupContent="<div class='marker-box'><div class='marker-edit "+a+"'><p>Time <input type='text' name='markerHours"+a+"' class='markerTextBox watermark' id='markerHours' maxlength='1' title='h' /> : <input type='text' name='markerMins"+a+"' class='markerTextBox watermark' id='markerMins' maxlength='2' title='mm' /></p><p><label for='lootCrate'><input type='radio' name='markerType"+a+"' id='lootCrate' value='lootCrate' /> Loot Crate</label><br /><label for='uplinkBlockade'><input type='radio' name='markerType"+a+"' id='uplinkBlockade' value='uplinkBlockade' /> Uplink/Blockade<br /><label for='custom'><input type='radio' name='markerType"+a+"' id='custom' value='custom' checked='checked' /> Custom</label></p><a href='#' class='saveMarkerButton'>Save</a> | <a href='#' class='deleteMarkerButton'>Delete</a> | <a href='#' class='resetMarkerButton'>Restart</a></div>",popupContent}function deleteAllMarkers(){return localStorage.setItem("markerData",""),!0}function deletePresetMarkers(){for(var a in markerData){var b=markerData[a];"lootCrate"!=b[5]&&"uplinkBlockade"!=b[5]||delete markerData[a]}storeMarkers(markerData)}function addPresetMarkers(){var b=(Date.now(),new Object);b.silentValley=[368,1386],b.summitAirfield=[1576,537],b.summitAirfield2=[1531,530],b.summitAirfield3=[1525,573],b.sneakyDevilsberg=[1501,1e3],b.sneakyDevilsberg2=[1480,930],b.hellsPeak=[1321,681],b.northernExcavation=[1251,1300],b.hotelBravo=[965,1402],b.wolfpineTunnel=[860,389],b.wolfpine=[810,483],b.mistyvale=[925,858],b.mistyvale2=[846,828],b.mistyvale3=[835,828],b.mistyvale4=[824,840],b.mistyvale5=[826,923],b.patsRepairShop=[792,1058],b.melsGrainFarm=[640,988],b.southernExcavation=[449,679],b.jaysResort=[484,943],b.jaysResort2=[474,924],b.adamsScrapyard=[571,1110],b.adamsScrapyard2=[534,1100],b.fortQCLewis=[593,1357],b.fortQCLewis2=[571,1359];var c=new Object;c.westBlockade=[1179,622],c.eastBlockade=[756,1394];var d=new Object;d.westUplink=[1053,298],d.westUplink2=[772,666],d.eastUplink=[973,1487],deletePresetMarkers();var e=0;for(var f in b){var g=b[f],h=["lootCrate"+e,g,2,"00",0,"lootCrate"];markerData["lootCrate"+e]=h,e+=1}var e=0;for(var f in c){var g=c[f],h=["blockade"+e,g,0,45,0,"uplinkBlockade"];markerData["blockade"+e]=h,e+=1}var e=0;for(var f in d){var g=d[f],h=["uplink"+e,g,0,45,0,"uplinkBlockade"];markerData["uplink"+e]=h,e+=1}return storeMarkers(markerData),!0}var map=L.map("mapid",{crs:L.CRS.Simple,minZoom:0,maxZoom:2,zoomSnap:.5,zoomDelta:.5,maxBoundsViscosity:.8}),bounds=[[0,0],[1744,1738]],image=L.imageOverlay("images/map.jpg",bounds).addTo(map),markerData,popupOptions,toolTipSettings={permanent:!0,direction:"top",opacity:"0.9"},markerData=new Object;map.fitBounds(bounds),map.setMaxBounds(bounds),$(".leaflet-container").css("cursor","crosshair"),window.onload=function(){markerData=getMarkers(),markerData=loadMarkers(markerData),storeMarkers(markerData)},$(".deleteAllMarkers:visible").click(function(){confirm("Are you sure you want to REMOVE all markers?")&&(deleteAllMarkers(),location.reload())}),$(".resetMarkers:visible").click(function(){confirm("Are you sure you want add markers for loot crates, blockades, and uplinks?")&&(addPresetMarkers(),location.reload())}),map.on("click",onMapClick);